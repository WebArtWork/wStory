import{a as x}from"./chunk-DND7ZSTE.js";import{e as j}from"./chunk-CLQKAVLW.js";import"./chunk-N6ULEWAM.js";import{Gb as k,Ib as I,L as h,M as u,N as v,X as y,Za as w,_,bb as g,f as m,i as l,jb as S,kb as C,s as p,zb as b}from"./chunk-OMW3WEZW.js";var R={formId:"storyevent",title:"Storyevent",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill storyevent title"},{name:"Label",value:"Title"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill storyevent description"},{name:"Label",value:"Description"}]}]};var f=(()=>{let e=class e{constructor(s,i,t,c,d,F){this._storyeventService=s,this._translate=i,this._alert=t,this._form=c,this._core=d,this._router=F,this.story=this._router.url.includes("/events/")?this._router.url.replace("/events/",""):"",this.columns=["name"],this.form=this._form.getForm("storyevent",R),this.config={paginate:this.setRows.bind(this),perPage:20,setPerPage:this._storyeventService.setPerPage.bind(this._storyeventService),allDocs:!1,create:this.story?()=>{this._form.modal(this.form,{label:"Create",click:(o,n)=>m(this,null,function*(){n(),this._preCreate(o),yield l(this._storyeventService.create(o)),this.setRows()})})}:null,update:o=>{this._form.modal(this.form,[],o).then(n=>{this._core.copy(n,o),this._storyeventService.update(o)})},delete:o=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this storyevent?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>m(this,null,function*(){yield l(this._storyeventService.delete(o)),this.setRows()})}]})},buttons:[{icon:"arrow_upward",click:o=>{let n=this.rows.findIndex(r=>r._id===o._id);[this.rows[n],this.rows[n-1]]=[this.rows[n-1],this.rows[n]];for(let r=0;r<this.rows.length;r++)this.rows[r].order!==r&&(this.rows[r].order=r,this._storyeventService.update(this.rows[r]))}},{icon:"cloud_download",click:o=>{this._form.modalUnique("storyevent","url",o)}}],headerButtons:[this.story?{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"}:null,{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}]},this.rows=[],this._page=1,this.setRows()}setRows(s=this._page){this._page=s,this._core.afterWhile(this,()=>{this._storyeventService.get({page:s}).subscribe(i=>{this.rows.splice(0,this.rows.length),this.rows.push(...i)})},250)}_bulkManagement(s=!0){return()=>{this._form.modalDocs(s?[]:this.rows).then(i=>m(this,null,function*(){if(s)for(let t of i)this._preCreate(t),yield l(this._storyeventService.create(t));else{for(let t of this.rows)i.find(c=>c._id===t._id)||(yield l(this._storyeventService.delete(t)));for(let t of i){let c=this.rows.find(d=>d._id===t._id);c?(this._core.copy(t,c),yield l(this._storyeventService.update(c))):this.story&&(this._preCreate(t),yield l(this._storyeventService.create(t)))}}this.setRows()}))}}_preCreate(s){delete s.__created,s.story=this.story}};e.\u0275fac=function(i){return new(i||e)(h(x),h(b),h(C),h(I),h(S),h(w))},e.\u0275cmp=u({type:e,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","Events",3,"columns","config","rows"]],template:function(i,t){i&1&&_(0,"wtable",0),i&2&&y("columns",t.columns)("config",t.config)("rows",t.rows)},dependencies:[k],encapsulation:2});let a=e;return a})();var P=[{path:"",component:f},{path:":story",component:f}],H=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=v({type:e}),e.\u0275inj=p({imports:[g.forChild(P),j]});let a=e;return a})();export{H as EventsModule};
