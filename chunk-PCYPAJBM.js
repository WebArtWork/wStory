import{Za as u,jb as c,kb as d,ob as m,pb as p,qb as f,r as l,u as o,yb as s}from"./chunk-OMW3WEZW.js";var b=(()=>{let i=class i extends f{get thumb(){return!this.user.thumb||this.user.thumb.includes("assets/default.png")?"assets/default.png":this.url+this.user.thumb}constructor(e,r,n,g,w){super({name:"user",replace:t=>{t.roles=[],t.data=t.data||{};for(let a of s.userFields||[])t.data[a]=t.data[a]||{};for(let a of this.roles)t.is[a]&&t.roles.push(a);return t}}),this._http=e,this._store=r,this._alert=n,this._core=g,this._router=w,this.url=s.url,this.roles=(s.roles||[]).concat(["admin"]),this.employees=s.roles||[],this.mode="dark",this.modes=(s.modes||[]).concat(["dark","white"]),this.users=this.getDocs(),this.user=localStorage.getItem("waw_user")?JSON.parse(localStorage.getItem("waw_user")):this.new(),this.usersByRole={},this._changingPassword=!1,this.filteredDocuments(this.usersByRole,"roles"),this.fetch({},{name:"me"}).subscribe(t=>{t?(!localStorage.getItem("waw_user")&&this._router.url==="/sign"&&this._router.navigateByUrl("/profile"),this.setUser(t)):localStorage.getItem("waw_user")&&this.logout()}),this.get({query:s.appId?"appId="+s.appId:""}),this._store.get("mode",t=>{t?this.setMode(t):this.setMode("dark")})}setMode(e="white"){if(e==="white"){this._store.remove("mode");for(let r of this.modes)document.body.parentNode.classList.remove(r)}else this._store.set("mode",e),document.body.parentNode.classList.add(e);this.mode=e}setUser(e){this.user=e,localStorage.setItem("waw_user",JSON.stringify(e)),this._core.complete("us.user")}role(e){return!!(this.user?.is||{})[e]}updateMe(){this.setUser(this.user),this.update(this.user)}updateMeAfterWhile(){this.setUser(this.user),this.updateAfterWhile(this.user)}changePassword(e,r){this._changingPassword||(this._changingPassword=!0,this._http.post("/api/user/changePassword",{newPass:r,oldPass:e},n=>{this._changingPassword=!1,n?this._alert.info({text:"Successfully changed password"}):this._alert.error({text:"Incorrect current password"})}))}logout(){this.user=this.new(),localStorage.removeItem("waw_user"),this._http.remove("token"),this._http.get("/api/user/logout"),this._router.navigateByUrl("/sign"),setTimeout(()=>{location.reload()},100)}updateAdmin(e){this.update(e,{name:"admin"})}deleteAdmin(e){this.delete(e,{name:"admin"})}};i.\u0275fac=function(r){return new(r||i)(o(p),o(m),o(d),o(c),o(u))},i.\u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"});let h=i;return h})();export{b as a};
